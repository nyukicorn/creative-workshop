<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360° Panorama VR Experience</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        #info { position: absolute; top: 10px; left: 10px; color: white; z-index: 100; }
        #controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100; }
        button { padding: 10px 20px; margin: 5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: rgba(0,0,0,0.9); }
    </style>
</head>
<body>
    <div id="info">
        <h3>360° Panorama VR</h3>
        <p>ドラッグで視点移動 | ホイールでズーム | VR対応</p>
    </div>
    <div id="controls">
        <button onclick="toggleAudio()">音楽 ON/OFF</button>
        <button onclick="enterVR()">VRモード</button>
    </div>
    <audio id="bgAudio" loop>
        <source src="./assets/audio/ambient_background.wav" type="audio/wav">
    </audio>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        let scene, camera, renderer, controls, audio;
        
        function init() {
            // シーン設定
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            
            // コントロール設定
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // パノラマスフィア作成
            const geometry = new THREE.SphereGeometry(500, 60, 40);
            geometry.scale(-1, 1, 1); // 内側から見えるように反転
            
            const loader = new THREE.TextureLoader();
            loader.load('./assets/panorama/panorama_landscape.png', function(texture) {
                const material = new THREE.MeshBasicMaterial({ map: texture });
                const sphere = new THREE.Mesh(geometry, material);
                scene.add(sphere);
            });
            
            // 音楽設定
            audio = document.getElementById('bgAudio');
            
            // レンダリングループ
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        function toggleAudio() {
            if (audio.paused) {
                audio.play();
            } else {
                audio.pause();
            }
        }
        
        function enterVR() {
            if (navigator.xr) {
                // WebXR VR実装
                alert('VR機能は開発中です');
            } else {
                alert('このブラウザはVRに対応していません');
            }
        }
        
        // ウィンドウリサイズ対応
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        init();
    </script>
</body>
</html>